# Формат ответа от адаптера СМЭВ 3

Для обработки ответа от адаптера СМЭВ 3 модулем бизнес-логики предоставляется
функция `on_responding_stomp_message`, которая принимает единственный аргумент.
Функция возвращает булево значение `false` в случае невозможности обработки
сообщения и булево значение `true` в случае успешной обработки. Для успешной
обработки необходимо и достаточно выполнение следующих условий.

1.  Аргументом функции `on_responding_stomp_message` является объект класса
    `Stomp::Message`.

2.  Тело сообщения является JSON-представлением ассоциативного массива
    следующей структуры:

    ```ruby
    {
      id:     <original_message_id>,
      format: <format>,
      content: {
        special_data: <special_data>
      }
    }
    ```
    где `<original_message_id>` — строка с идентификатором исходного сообщения
    STOMP с информацией о межведомственном запросе (см. формат запроса к
    адаптеру СМЭВ 3 в документе REQUESTS.md), `<format>` — это одна из строк
    `EXCEPTION`, `REJECTION`, `RESPONSE`, а `special_data` — это строка с
    информацией об ответе.

3.  Существует запись запроса `<request>` с атрибутом `msp_message_id`, чьё
    значение равно строке `<original_message_id>` (см. формат запроса к
    адаптеру СМЭВ 3 в документе REQUESTS.md). Запись запроса ассоциирована с
    записью заявки `<case>`.

4.  Значением поля `type` записи заявки `<case>` является строка `msp_case`.

5.  Значением атрибута `status` записи заявки `<case>` является строка
    `processing`.

Если вышеприведённые условия выполнены, то в течение дальнейшей обработки
сообщения к атрибутам запроса добавляется атрибут `response_content` со
значением, равным строке `<special_data>` (см. условие 2). Также обновляются
статус и другие атрибуты заявки (см. документ ATTRIBUTES.md).
