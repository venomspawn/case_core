# События бизнес-логики

Приложение предоставляет оповещение о следующих видах событий при работе с
модулями бизнес-логики:

*   загрузка модуля в приложение;
*   выгрузка модуля из памяти приложения;
*   создание заявки;
*   получение STOMP-сообщения из очереди ответных сообщений.

Кроме того, приложение поддерживает специальный вид оповещения, привязываемый к
уже существующей записи заявки.

Поддержка оповещений со стороны модулей бизнес-логики не является обязательной.
Если поддержка того или иного оповещения отсутствует в модуле, то приложение
создаёт соответствующее сообщение в стандартном потоке вывода. Созданные при
вызове исключения блокируются, но сообщение о них выводится в стандартный поток
вывода.

## Оповещение о загрузке модуля бизнес-логики в приложение

*   Поддержка со стороны модуля бизнес-логики осуществляется предоставлением
    функции `on_load`.

*   Функция `on_load` вызывается приложением без аргументов непосредственно
    после загрузки модуля бизнес-логики.

## Оповещение о выгрузке модуля бизнес-логики из памяти приложения

*   Поддержка со стороны модуля бизнес-логики осуществляется предоставлением
    функции `on_unload`.

*   Функция `on_unload` вызывается приложением без аргументов непосредственно
    перед выгрузкой модуля бизнес-логики из пространства имён `Object`.

## Оповещение о создании записи заявки

*   Поддержка со стороны модуля бизнес-логики осуществляется предоставлением
    функции `on_case_creation`.

*   Функция `on_case_creation` вызывается действием класса
    `CaseCore::Actions::Cases::Create` непосредственно после создания записи
    заявки, при этом модуль бизнес-логики ищется по значению поля `type`
    записи.

*   Если модуль бизнес-логики невозможно найти по значению поля `type` записи
    заявки, то создаётся соответствующее предупредительное сообщение в
    стандартном потоке вывода, после чего генерируется исключение (которое
    отменяет транзакцию создания записи заявки).

*   Если модуль бизнес-логики не предоставляет функцию `on_case_creation`, то
    генерируется исключение (которое отменяет транзакцию создания записи
    заявки).

*   Если в процессе вызова функции `on_case_creation` создаётся исключение
    класса `ArgumentError` или производного от него, то это исключение не
    блокируется, что приводит к отмене транзакции создания записи заявки.

*   Если в процессе вызова функции `on_case_creation` создаётся исключение
    класса, которые не является классом `ArgumentError` или производным от
    него, то такое исключение блокируется, не приводит к отмене транзакции
    создания записи заявки. Информация о нём попадает в стандартный поток
    вывода в рамках соответствующего предупредительного сообщения.

## Оповещение о STOMP-сообщении из очереди ответных сообщений

*   Поддержка со стороны модуля бизнес-логики осуществляется предоставлением
    функции `on_responding_stomp_message`.

*   При вызове функции `on_responding_stomp_mesage` приложение использует в
    качестве аргумента функции объект класса `Stomp::Message`, который
    содержит в себе информацию о STOMP-сообщении.

*   При получении STOMP-сообщения из очереди ответных сообщений приложение
    начинает вызывать функцию `on_responding_stomp_message` у всех загруженных
    модулей бизнес-логики, пока функция не вернёт значение, отличающееся от
    `nil` и `false`.

*   Приложение пропускает модуль, если он не поддерживает функцию
    `on_responding_stomp_message`. При этом создаётся соответствующее
    отладочное сообщение в стандартном потоке вывода.

*   Ошибки во время вызова функции `on_responding_stomp_message` игнорируются
    приложением, но соответствующие сообщения об ошибках создаются в
    стандартном потоке вывода. Модуль бизнес-логики при этом пропускается
    приложением.

*   Если приложение не нашло модуль бизнес-логики, у которого функция
    `on_responding_stomp_message` вернула значение, отличающееся от `nil` или
    `false`, то приложение создаёт соответствующее предупредительное сообщение
    в стандартном потоке вывода.

## Оповещение, привязанное к записи заявки

*   Позволяет вызвать произвольную функцию модуля бизнес-логики с записью
    заявки в качестве аргумента.

*   Со стороны приложения поддержка этого специального вида оповещений
    осуществляется действиями класса `CaseCore::Actions::Cases::Call`.

*   Действие поддерживает указание дополнительных аргументов.
